<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<style>
		html, body {
			height: 100%;
			margin: 0;
			padding: 0;
		}

		.canvas-container {
			height: calc(100% - 200px);
			display: inline-block;
			width: 100%;
		}

		.editor-container {
			position: absolute;
			left: 0;
			bottom: 0;
			height: 200px;
			background: #fafafa;
			outline: none;
			width: 100%;
			box-shadow: 0px 0px 10px #ccc;
		}

		#path-editor {
			height: 100%;
			font-family: Consolas;
			box-sizing: border-box;
			padding: 8px;
			border: none;
			outline: none;
			font-size: 12px;
			width: 100%;
		}

		svg {
			height: calc(100% - 200px);
			width: 100%;
			position: absolute;
			left:0;
			top:0;
			opacity: 0.5;
		}
	</style>
</head>
<body>
<div class="canvas-container">
	<canvas id="canvas"></canvas>
	<svg>
		<path fill="none" id="path" stroke="red" stroke-width="1" transform="scale(10)"></path>
	</svg>
</div>
<div spellcheck="false" class="editor-container">
<!-- <textarea id="path-editor">M100,350 l 50,-25
a25,25 -30 0,1 50,-25 l 50,-25
a25,50 -30 0,1 50,-25 l 50,-25
a25,75 -30 0,1 50,-25 l 50,-25
a25,100 -30 0,1 50,-25 l 50,-25</textarea> -->
<textarea id="path-editor">
 M 3 18 h -2 c -0.552 0 -1 -0.448 -1 -1 v -13 c 0 -0.552 0.448 -1 1 -1 h 13 c 0.552 0 1 0.448 1 1 v 2 h 4.667 c 1.117 0 1.6 0.576 1.936 1.107 c 0.594 0.94 1.536 2.432 2.109 3.378 c 0.188 0.312 0.288 0.67 0.288 1.035 v 4.48 c 0 1.089 -0.743 2 -2 2 h -1 c 0 1.656 -1.344 3 -3 3 s -3 -1.344 -3 -3 h -6 c 0 1.656 -1.344 3 -3 3 s -3 -1.344 -3 -3 z  m 3 -1.2 c 0.662 0 1.2 0.538 1.2 1.2 c 0 0.662 -0.538 1.2 -1.2 1.2 c -0.662 0 -1.2 -0.538 -1.2 -1.2 c 0 -0.662 0.538 -1.2 1.2 -1.2 z  m 12 0 c 0.662 0 1.2 0.538 1.2 1.2 c 0 0.662 -0.538 1.2 -1.2 1.2 c -0.662 0 -1.2 -0.538 -1.2 -1.2 c 0 -0.662 0.538 -1.2 1.2 -1.2 z  m -3 -2.8 h -13 v 2 h 1.765 c 0.549 -0.614 1.347 -1 2.235 -1 c 0.888 0 1.686 0.386 2.235 1 h 7.53 c 0.549 -0.614 1.347 -1 2.235 -1 c 0.888 0 1.686 0.386 2.235 1 h 1.765 v -4.575 l -1.711 -2.929 c -0.179 -0.307 -0.508 -0.496 -0.863 -0.496 h -4.426 v 6 z  m -2 -9 h -11 v 7 h 11 v -7 z  m 3 4 v 3 h 5 l -1.427 -2.496 c -0.178 -0.312 -0.509 -0.504 -0.868 -0.504 h -2.705 z
</textarea>
</div>
</body>
<script type="text/javascript" src="./out/parse.1.js"></script>
<script type="text/javascript" src="./out/parse.js"></script>
<script>

var editor = document.getElementById('path-editor');
var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");
var path = document.getElementById('path');
var parser;
var d;


function parse() {
	d = editor.value;
	ctx.clearRect(0,0,canvas.width,canvas.height);
	path.setAttribute('d', d);
	

	
	ctx.beginPath();
	parser = new SVGPath(d);
	parser.draw(ctx);

	ctx.restore();
	ctx.strokeStyle = "#0000FF";
	ctx.lineWidth = 1;
	ctx.stroke();
	// parser.doMagic(ctx, d);
	// ctx.stroke();
}

canvas.width = document.body.clientWidth;
canvas.height = document.body.clientHeight;
ctx.strokeWidth = 2;
ctx.strokeStyle = "#000000";

editor.onkeyup = function () {
	parse();
}

parse();

function rotate(cx, cy, p, theta) {
	var pPrime = {x:0, y:0};
	pPrime.x = (p.x - cx) * Math.cos(theta) - (p.y - cy) * Math.sin(theta) + cx;
	pPrime.y = (p.x - cx) * Math.sin(theta) + (p.y - cy) * Math.cos(theta) + cy;
	return pPrime;
}

function ellipticalArc(x, y, w, h, sa, ea) {
	this.x = x 
	this.y = y
	this.w = w
	this.h = h

	this.sa = sa;
	this.ea = ea;
	this.theta = this.ea - this.sa;

	if (this.theta < 0)
		this.theta = (2 * Math.PI + this.theta);

	this.length = Math.atan(this.w / this.h * Math.tan(this.theta));

	this.length = ( 1.111 * ( Math.sqrt(
		Math.pow(this.w / 2 * (Math.cos(this.sa) - Math.cos(this.ea) ), 2) +
		Math.pow(this.h / 2 * (Math.sin(this.sa) - Math.sin(this.ea) ), 2)
	)));

	this.getPoint = function (n) {
		return {
			x: this.x + this.w / 2 * Math.cos(this.sa + n * this.theta),
			y: this.y + this.h / 2 * Math.sin(this.sa + n * this.theta)
		};
	};

	this.plot = (n, angle) => {
		ctx.fillStyle = "#000000";
		var point = angle ? rotate(this.x, this.y, this.getPoint(n), angle / 180 * Math.PI) : this.getPoint(n);
		ctx.fillRect(point.x, point.y, 1, 1);
	};
}




</script>
</html>